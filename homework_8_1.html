<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Homework 8-1</title>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<style>
 body {font-family:Arial, sans-serif; max-width:800px; margin:auto; padding:24px;}
 .question {margin:24px 0;}
 label {display:block; margin-top:6px;}
 .submit-btn {padding:8px 16px; font-size:1rem; margin-top:20px;}
</style>
</head>
<body>
<h1>Homework 8-1</h1>

<form id="hwForm">
  <input type="hidden"  name="homeworkId" value="Homework 8-1">
  <label>First Name <input type="text"  name="firstName" required></label>
  <label>Last Name  <input type="text"  name="lastName"  required></label>

<!-- ── 15 placeholder questions (replace text & LaTeX as desired) ── -->
<script>
/* build questions dynamically for brevity */
const totalQ = 15;                     // must match ANSWER_KEYS length
const container = document.currentScript.parentElement;

for (let i = 1; i <= totalQ; i++) {
  const div = document.createElement("div");
  div.className = "question";
  div.innerHTML =
    `<p><strong>Question ${i}:</strong> (write your LaTeX here)</p>` +
    ["A","B","C","D","E","F"].map(l =>
      `<label><input type="radio" name="q${i}" value="${l}"> ${l}</label>`
    ).join("");
  container.insertBefore(div, document.getElementById("hwForm").querySelector(".submit-btn"));
}
</script>

  <button class="submit-btn" type="submit">Submit</button>
</form>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbxRgH1sy5k_qgRzeHv48N2y2GG6Kpn4Qel1d6ASofzmPzCtV-04UupmIVlAc6WlfLrHcw/exec";   //  <<<  replace with your Web-App URL

document.getElementById("hwForm").addEventListener("submit", async e => {
  e.preventDefault();
  const f = e.target;
  const data = new FormData();

  /* collect name + HW ID */
  ["firstName","lastName","homeworkId"].forEach(k => data.append(k, f[k].value.trim()));

  /* collect answers */
  const answers = [];
  for (let i = 1; ; i++) {
    const radios = f[`q${i}`];
    if (!radios) break;                         // reached end
    const sel = [...radios].find(r => r.checked);
    if (!sel) return alert(`Please answer Q${i}.`);
    answers.push(sel.value);
  }
  data.append("answers", JSON.stringify(answers));

  /* send to Apps Script */
  try {
    const res  = await fetch(scriptURL, {method:"POST", body:data});
    const text = await res.text();
    handleReply(text);
  } catch (err) {
    alert("Network / script error: " + err);
  }
});

/* ----------  interpret reply ---------- */
function handleReply(msg) {
  // formats:
  //  SUBMITTED|score|total
  //  SUBMITTED_LATE|score|total
  //  RETRY|score|total
  //  ERR|REASON

  if (msg.startsWith("SUBMITTED|")) {
    const [,score,total] = msg.split("|");
    alert(`First submission recorded!\nScore: ${score}/${total}\nYou may retry once (max 85 %).`);
  }
  else if (msg.startsWith("SUBMITTED_LATE|")) {
    const [,score,total] = msg.split("|");
    alert(`Submitted after the due date – capped at 85 %.\nScore: ${score}/${total}\nOne retry (also 85 %) allowed.`);
  }
  else if (msg.startsWith("RETRY|")) {
    const [,score,total] = msg.split("|");
    alert(`Retry recorded.\nScore (85 % cap): ${score}/${total}\nNo further attempts allowed.`);
  }
  else if (msg.startsWith("ERR|INVALID_NAME")) {
    alert("Name not found in roster – submission rejected.");
  }
  else if (msg.startsWith("ERR|LIMIT_EXCEEDED")) {
    alert("You have already submitted twice.");
  }
  else {
    alert("Unexpected reply: " + msg);
  }
}
</script>
</body>
</html>
